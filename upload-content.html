<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Upload Course Content</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 2rem;
            background: #fcfcfc;
            color: #222;
            line-height: 1.6;
        }

        h1 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
        }

        form {
            max-width: 600px;
        }

        label {
            display: block;
            margin-top: 1.5rem;
            font-weight: bold;
        }

        input[type="text"], input[type="url"], textarea, input[type="file"] {
            width: 100%;
            padding: 0.6rem;
            margin-top: 0.5rem;
            border-radius: 5px;
            border: 1px solid #bbb;
        }

        input[type="file"] {
            background: #fff;
        }

        .upload-group {
            margin-top: 2rem;
            padding: 1rem;
            border: 1px dashed #ccc;
            border-radius: 5px;
            background: #f9f9f9;
        }

        .file-preview {
            margin-top: 1rem;
            padding: 0.5rem;
            background: #eee;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        button {
            margin-top: 2rem;
            padding: 0.7rem 1.2rem;
            background: #2c7be5;
            color: white;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
        }

        button:hover {
            background: #195cb2;
        }
    </style>
</head>
<body>
    <h1>Upload Learning Materials</h1>
    <p>You can throw a whole bunch of content at us — notes, slides, videos, links — and we'll turn it into a structured course later. This is your raw material zone.</p>

    <form id="uploadForm">
        <label for="rawText">Paste Notes or Written Content</label>
        <textarea id="rawText" name="rawText" rows="6" placeholder="Copy and paste anything here…"></textarea>

        <div class="upload-group">
            <label for="fileUpload">Upload Files (PDF, DOCX, PNG, JPG)</label>
            <input type="file" id="fileUpload" name="files" accept=".pdf,.doc,.docx,.png,.jpg,.jpeg" multiple>
            <div id="filePreview" class="file-preview"></div>
        </div>

        <label for="videoLink">YouTube or Website Link</label>
        <input type="url" id="videoLink" name="videoLink" placeholder="https://youtube.com/watch?v=... or https://any.site">

        <button type="submit">Upload Content</button>
    </form>

    <script>
        const form = document.getElementById('uploadForm');
        const fileInput = document.getElementById('fileUpload');
        const filePreview = document.getElementById('filePreview');

        // File preview logic
        fileInput.addEventListener('change', () => {
            filePreview.innerHTML = '';
            if (fileInput.files.length === 0) {
                filePreview.textContent = 'No files selected.';
                return;
            }
            Array.from(fileInput.files).forEach(file => {
                const info = document.createElement('div');
                info.textContent = `• ${file.name} (${Math.round(file.size / 1024)} KB)`;
                filePreview.appendChild(info);
            });
        });

        // Form submit logic
        form.addEventListener('submit', async e => {
            e.preventDefault();

            const text = document.getElementById('rawText').value.trim();
            const link = document.getElementById('videoLink').value.trim();
            const files = fileInput.files;

            if (!text && files.length === 0 && !link) {
                alert("Please add some content — text, files, or a link.");
                return;
            }

            // Create a FormData object to send data to the server
            const formData = new FormData();
            formData.append('rawText', text);
            formData.append('videoLink', link);
            
            for (let i = 0; i < files.length; i++) {
                formData.append('files', files[i]);
            }

            try {
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData,
                });

                if (response.ok) {
                    alert('Content uploaded successfully!');
                    // Redirect or clear form after successful upload
                    // window.location.href = 'course-detail.html';
                    form.reset();
                    filePreview.innerHTML = '';
                } else {
                    const error = await response.json();
                    alert(`Upload failed: ${error.message}`);
                }
            } catch (error) {
                alert('An error occurred. Please check the server.');
                console.error('Error:', error);
            }
        });
    </script>
</body>
</html>